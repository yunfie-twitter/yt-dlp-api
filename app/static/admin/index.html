<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>yt-dlp-api Admin</title>
    
    <!-- Beer CSS & Vue.js -->
    <link href="https://cdn.jsdelivr.net/npm/beercss@3.5.1/dist/cdn/beer.min.css" rel="stylesheet">
    <script type="module" src="https://cdn.jsdelivr.net/npm/beercss@3.5.1/dist/cdn/beer.min.js"></script>
    <script type="module" src="https://cdn.jsdelivr.net/npm/material-dynamic-colors@1.1.0/dist/cdn/material-dynamic-colors.min.js"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

    <style>
        :root {
            --primary: #0052cc;
            --on-primary: #ffffff;
        }
        .login-screen {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
        .login-card {
            width: 100%;
            max-width: 400px;
        }
        .code-editor {
            font-family: monospace;
            background: #f5f5f5;
            padding: 1rem;
            border-radius: 4px;
            width: 100%;
            min-height: 300px;
        }
    </style>
</head>
<body class="light">
    <div id="app">
        <!-- ログイン画面 -->
        <div v-if="!isAuthenticated" class="login-screen">
            <article class="login-card">
                <h5>yt-dlp-api Admin</h5>
                <div class="field border label">
                    <input type="password" v-model="loginForm.password" @keyup.enter="login">
                    <label>Password</label>
                </div>
                
                <div v-if="loginError" class="chip error">{{ loginError }}</div>
                
                <nav class="right-align">
                    <button @click="login">Login</button>
                    <button v-if="ssoEnabled" class="border" @click="loginGoogle">
                        <img src="https://www.google.com/favicon.ico" class="circle">
                        <span>Google Login</span>
                    </button>
                </nav>
            </article>
        </div>

        <!-- メイン画面 -->
        <div v-else>
            <nav class="left drawer m l">
                <header>
                    <img src="https://github.com/yunfie-twitter.png" class="circle">
                    <h6>Admin Console</h6>
                </header>
                
                <a @click="currentView = 'dashboard'" :class="{ active: currentView === 'dashboard' }">
                    <i>dashboard</i>
                    <span>Dashboard</span>
                </a>
                <a @click="currentView = 'settings'" :class="{ active: currentView === 'settings' }">
                    <i>settings</i>
                    <span>Settings</span>
                </a>
                <a @click="currentView = 'users'" :class="{ active: currentView === 'users' }">
                    <i>group</i>
                    <span>Users</span>
                </a>
                
                <div class="divider"></div>
                
                <a @click="logout">
                    <i>logout</i>
                    <span>Logout</span>
                </a>
            </nav>

            <main class="responsive">
                <!-- Dashboard View -->
                <div v-if="currentView === 'dashboard'">
                    <h5>Dashboard</h5>
                    <div class="grid">
                        <article class="s12 m6 l3">
                            <h6>System Status</h6>
                            <p class="green-text">Online</p>
                        </article>
                        <article class="s12 m6 l3">
                            <h6>Active Downloads</h6>
                            <p>{{ stats.active_downloads || 0 }}</p>
                        </article>
                    </div>
                </div>

                <!-- Settings View -->
                <div v-if="currentView === 'settings'">
                    <header>
                        <h5>System Configuration</h5>
                        <button class="circle" @click="fetchConfig"><i>refresh</i></button>
                        <button class="circle primary" @click="saveConfig"><i>save</i></button>
                    </header>

                    <div v-if="config" class="grid">
                        <!-- Rate Limit -->
                        <article class="s12 l6">
                            <h6>Rate Limiting</h6>
                            <div class="field label border">
                                <label class="switch">
                                    <input type="checkbox" v-model="config.rate_limit.enabled">
                                    <span></span>
                                </label>
                                <span>Enable Rate Limit</span>
                            </div>
                            <div class="field label border">
                                <input type="number" v-model.number="config.rate_limit.max_requests">
                                <label>Max Requests</label>
                            </div>
                        </article>

                        <!-- Downloads -->
                        <article class="s12 l6">
                            <h6>Download Settings</h6>
                            <div class="field label border">
                                <input type="number" v-model.number="config.download.max_concurrent">
                                <label>Max Concurrent</label>
                            </div>
                            <div class="field label border">
                                <input type="number" v-model.number="config.download.timeout_seconds">
                                <label>Timeout (sec)</label>
                            </div>
                        </article>

                         <!-- Security -->
                         <article class="s12 l6">
                            <h6>Security</h6>
                            <div class="field label border">
                                <label class="switch">
                                    <input type="checkbox" v-model="config.security.enable_ssrf_protection">
                                    <span></span>
                                </label>
                                <span>SSRF Protection</span>
                            </div>
                        </article>
                    </div>
                </div>

                <!-- Users View -->
                <div v-if="currentView === 'users'">
                    <h5>User Management</h5>
                    <table class="border">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Email</th>
                                <th>Type</th>
                                <th>Last Login</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="user in users" :key="user.id">
                                <td>{{ user.id }}</td>
                                <td>{{ user.email }}</td>
                                <td>{{ user.is_sso ? 'SSO' : 'Local' }}</td>
                                <td>{{ user.last_login }}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </main>
        </div>
        
        <!-- Toast Notification -->
        <div class="snackbar" :class="{ active: toast.show }">{{ toast.message }}</div>
    </div>

    <script src="/static/admin/admin.js"></script>
</body>
</html>
