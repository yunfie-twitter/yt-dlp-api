<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>yt-dlp Web Client</title>

<link href="https://cdn.jsdelivr.net/npm/beercss@3.13.1/dist/cdn/beer.min.css" rel="stylesheet">
<script type="module" src="https://cdn.jsdelivr.net/npm/beercss@3.13.1/dist/cdn/beer.min.js"></script>
<script type="module" src="https://cdn.jsdelivr.net/npm/material-dynamic-colors@1.1.2/dist/cdn/material-dynamic-colors.min.js"></script>
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

<style>
/* ===== 共通 ===== */
.app-title {
    font-weight: 600;
    letter-spacing: .5px;
}

.card {
    border-radius: 16px;
}

.soft {
    color: rgba(255,255,255,.65);
}

/* ===== サムネ ===== */
.thumbnail {
    position: relative;
    aspect-ratio: 16 / 9;
    overflow: hidden;
    border-radius: 16px;
}

.thumbnail img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.duration-badge {
    position: absolute;
    bottom: 8px;
    right: 8px;
    background: rgba(0,0,0,.75);
    padding: 4px 8px;
    border-radius: 6px;
    font-size: 12px;
}

/* ===== 動画情報 ===== */
.video-title {
    font-size: 1.05rem;
    font-weight: 600;
    line-height: 1.4;
}

.meta-row {
    display: flex;
    gap: 12px;
    font-size: 13px;
    margin-top: 6px;
}

/* ===== ダウンロード ===== */
.download-box {
    margin-top: 1rem;
    padding: 1rem;
    border-radius: 16px;
    background: rgba(255,255,255,.05);
}

/* ===== 履歴 ===== */
.history-card {
    transition: transform .15s, background .15s;
}
.history-card:hover {
    transform: translateY(-2px);
    background: rgba(255,255,255,.05);
}

/* ===== モーダル ===== */
.modal-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,.65);
    z-index: 900;
}
dialog {
    z-index: 1000;
    border-radius: 16px;
}
</style>
</head>

<body class="dark">
<div id="app">

<header>
<nav>
<button class="circle transparent" data-ui="#drawer-left">
<i>menu</i>
</button>
<h6 class="max app-title">yt-dlp Web Client</h6>
</nav>
</header>

<nav id="drawer-left" class="left">
<header>
<img src="https://www.beercss.com/favicon.png" class="circle">
<h6>yt-dlp Web</h6>
</header>

<a @click="navigate('home')"><i>home</i><span>ホーム</span></a>
<a @click="navigate('history')"><i>history</i><span>履歴</span></a>
</nav>

<main class="responsive">

<!-- ===== HOME ===== -->
<section v-if="page==='home'">

<article class="border card">
<div class="padding">
<h6>動画URL</h6>
<div class="field label border">
<input v-model="url" @keyup.enter="fetchInfo">
<label>YouTube / Twitter / ニコ動</label>
</div>

<nav class="right-align">
<button class="primary" @click="fetchInfo" :disabled="loading">
<i>search</i>
<span>{{ loading ? '解析中…' : '解析' }}</span>
</button>
</nav>
</div>
</article>

<!-- 動画情報 -->
<article v-if="info" class="border card">
<div class="grid">

<div class="s12 m5">
<div class="thumbnail">
<img :src="info.thumbnail">
<div class="duration-badge">
{{ formatDuration(info.duration) }}
</div>
</div>
</div>

<div class="s12 m7">
<div class="padding">

<div class="video-title">{{ info.title }}</div>

<div class="meta-row soft">
<span><i>person</i> {{ info.uploader }}</span>
<span><i>visibility</i> {{ info.view_count?.toLocaleString() }}</span>
</div>

<div class="download-box">
<div class="field suffix border">
<select v-model="quality">
<option value="">最高画質</option>
<option value="1080">1080p</option>
<option value="720">720p</option>
<option value="audio">音声のみ</option>
</select>
<i>high_quality</i>
</div>

<button class="primary responsive" @click="download" :disabled="downloading">
<i>download</i>
<span>{{ downloading ? 'ダウンロード中…' : 'ダウンロード' }}</span>
</button>
</div>

</div>
</div>
</article>

</section>

<!-- ===== HISTORY ===== -->
<section v-if="page==='history'">

<h5 class="padding">ダウンロード履歴</h5>

<article v-for="item in history" class="border card history-card">
<div class="row padding">
<img :src="item.thumbnail" style="width:120px;border-radius:12px">
<div class="max">
<p class="bold">{{ item.title }}</p>
<p class="soft small">{{ item.uploader }}</p>
</div>
</div>
</article>

</section>

</main>

</div>

<script>
const {createApp,ref} = Vue

createApp({
setup(){
const url=ref('')
const info=ref(null)
const loading=ref(false)
const downloading=ref(false)
const quality=ref('')
const page=ref('home')
const history=ref([])

const navigate=p=>page.value=p

const fetchInfo=async()=>{
loading.value=true
const r=await fetch('/info',{method:'POST',body:JSON.stringify({url:url.value})})
info.value=await r.json()
loading.value=false
}

const download=async()=>{
downloading.value=true
await fetch('/download',{method:'POST',body:JSON.stringify({url:url.value})})
history.value.unshift(info.value)
downloading.value=false
}

const formatDuration=s=>{
if(!s) return 'LIVE'
const m=Math.floor(s/60)
const sec=s%60
return `${m}:${sec.toString().padStart(2,'0')}`
}

return{url,info,loading,downloading,quality,page,history,navigate,fetchInfo,download,formatDuration}
}
}).mount('#app')
</script>

</body>
</html>
