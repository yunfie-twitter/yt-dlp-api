<!DOCTYPE html> <html lang="ja"> <head> <meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <title>yt-dlp Web Client</title> <link href="https://cdn.jsdelivr.net/npm/beercss@3.13.1/dist/cdn/beer.min.css" rel="stylesheet"> <script type="module" src="https://cdn.jsdelivr.net/npm/beercss@3.13.1/dist/cdn/beer.min.js"></script> <script type="module" src="https://cdn.jsdelivr.net/npm/material-dynamic-colors@1.1.2/dist/cdn/material-dynamic-colors.min.js"></script> <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script> <style> .thumbnail-container { position: relative; overflow: hidden; border-radius: 12px; } .thumbnail-container img { width: 100%; height: 100%; object-fit: cover; } .video-info-card { margin-top: 1rem; } .quality-selector { margin: 1rem 0; } .download-progress { display: inline-block; margin-left: 0.5rem; } .history-item { cursor: pointer; transition: background 0.2s; margin-bottom: 0.5rem; } .history-item:hover { background: rgba(255,255,255,0.1); } .history-thumbnail { width: 120px; height: 90px; object-fit: cover; border-radius: 8px; margin-right: 1rem; } .modal-overlay { position: fixed; inset: 0; background: rgba(0, 0, 0, 0.5); z-index: 999; display: none; } .modal-overlay.active { display: block; } dialog.active { z-index: 1000; } </style> </head> <body class="dark"> <div id="app"> <header> <nav> <button class="circle transparent" data-ui="#drawer-left"> <i>menu</i> </button> <h6 class="max">yt-dlp Web Client</h6> <button class="circle transparent"> <i>more_vert</i> </button> </nav> </header> <nav id="drawer-left" class="left"> <header> <img src="https://www.beercss.com/favicon.png" class="circle"> <h6>yt-dlp Web</h6> </header> <a @click="navigateToPage('home')"> <i>home</i> <span>ホーム</span> </a> <a @click="navigateToPage('history')"> <i>history</i> <span>ダウンロード履歴</span> </a> <div class="divider"></div> <a href="https://github.com/yunfie-twitter/yt-dlp-api" target="_blank"> <i>code</i> <span>GitHub リポジトリ</span> </a> <div class="divider"></div> <label class="row"> <span>ダークモード</span> <label class="switch"> <input type="checkbox" checked @change="toggleTheme"> <span></span> </label> </label> </nav> <main class="responsive"> <div class="space"></div> <div v-if="currentPage === 'home'"> <article class="border"> <div class="padding"> <h6>動画URLを入力</h6> <div class="field label border"> <input v-model="url" @keyup.enter="fetchInfo" type="text" :disabled="loading"> <label>YouTube, ニコニコ動画, Twitter など</label> </div> <nav class="right-align"> <button @click="pasteFromClipboard" :disabled="loading" class="primary"> <i>content_paste</i> <span>貼り付け</span> </button> <button @click="fetchInfo" :disabled="loading || !url" class="primary"> <i>search</i> <span>解析</span> <progress v-if="loading" class="circle small download-progress"></progress> </button> </nav> <div v-if="error" class="small-padding"> <article class="red-border round"> <i>error</i> <p>{{ error }}</p> </article> </div> </div> </article> <article v-if="info" class="border video-info-card"> <div class="grid"> <div class="s12 m4"> <div class="thumbnail-container"> <img :src="info.thumbnail" :alt="info.title"> </div> </div> <div class="s12 m8"> <div class="padding"> <h6 class="small">{{ info.title }}</h6> <p class="small-margin"> <i>person</i> <span>{{ info.uploader || 'Unknown' }}</span> </p> <div class="row small-margin"> <i>schedule</i> <span>{{ formatDuration(info.duration) }}</span> <span class="small-margin"> • </span> <i>visibility</i> <span>{{ info.view_count?.toLocaleString() || '0' }} views</span> </div> <div class="field suffix border quality-selector"> <select v-model="selectedQuality"> <option value="">最高画質 (Best)</option> <option value="1080">1080p</option> <option value="720">720p</option> <option value="480">480p</option> <option value="audio">音声のみ (Audio)</option> </select> <i>high_quality</i> </div> <nav> <button @click="download" :disabled="downloading" class="responsive primary"> <i>download</i> <span>ダウンロード</span> <progress v-if="downloading" class="circle small download-progress"></progress> </button> </nav> </div> </div> </div> </article> </div> <div v-if="currentPage === 'history'"> <article class="border"> <div class="padding"> <div class="row"> <h5 class="max">ダウンロード履歴</h5> <button @click="confirmClearHistory" class="primary" :disabled="history.length === 0"> <i>delete_sweep</i> <span>クリア</span> </button> </div> </div> </article> <div v-if="history.length === 0" class="padding"> <article class="border center-align"> <div class="padding"> <i class="extra">history</i> <p>履歴がありません</p> <button @click="navigateToPage('home')" class="primary"> <i>home</i> <span>ホームに戻る</span> </button> </div> </article> </div> <article v-else v-for="(item, index) in history" :key="index" class="border history-item" @click="loadFromHistory(item)"> <div class="row padding"> <img :src="item.thumbnail" class="history-thumbnail" :alt="item.title"> <div class="max"> <p class="bold">{{ item.title }}</p> <p class="small"> <i>person</i> {{ item.uploader }} </p> <p class="small"> <i>schedule</i> {{ new Date(item.timestamp).toLocaleString('ja-JP') }} </p> </div> <i>download</i> </div> </article> </div> <div class="space"></div> </main> <div class="modal-overlay" :class="{ active: showDeleteModal }" @click="showDeleteModal = false"></div> <dialog :class="{ active: showDeleteModal }"> <h5>履歴を削除</h5> <p>すべてのダウンロード履歴を削除しますか?</p> <nav class="right-align"> <button @click="showDeleteModal = false" class="border">キャンセル</button> <button @click="clearHistory" class="primary">削除</button> </nav> </dialog> </div> <script> const { createApp, ref, onMounted } = Vue createApp({ setup() { const url = ref('') const info = ref(null) const loading = ref(false) const downloading = ref(false) const error = ref(null) const selectedQuality = ref('') const currentPage = ref('home') const showDeleteModal = ref(false) const history = ref([]) const setCookie = (name, value, days = 365) => { const expires = new Date() expires.setTime(expires.getTime() + days * 24 * 60 * 60 * 1000) document.cookie = ${name}=${encodeURIComponent(JSON.stringify(value))};expires=${expires.toUTCString()};path=/ } const getCookie = (name) => { const nameEQ = name + '=' const ca = document.cookie.split(';') for (let i = 0; i < ca.length; i++) { let c = ca[i] while (c.charAt(0) === ' ') c = c.substring(1, c.length) if (c.indexOf(nameEQ) === 0) { return JSON.parse(decodeURIComponent(c.substring(nameEQ.length, c.length))) } } return null } const closeDrawer = () => { const drawer = document.querySelector('#drawer-left') if (drawer && drawer.classList.contains('active')) { drawer.classList.remove('active') } } const loadHistory = () => { const saved = getCookie('downloadHistory') if (saved) { history.value = saved } } const saveToHistory = (videoInfo) => { const historyItem = { url: url.value, title: videoInfo.title, thumbnail: videoInfo.thumbnail, uploader: videoInfo.uploader, timestamp: Date.now() } history.value.unshift(historyItem) if (history.value.length > 20) { history.value = history.value.slice(0, 20) } setCookie('downloadHistory', history.value) } const confirmClearHistory = () => { showDeleteModal.value = true } const clearHistory = () => { history.value = [] setCookie('downloadHistory', []) showDeleteModal.value = false } const loadFromHistory = (item) => { url.value = item.url currentPage.value = 'home' closeDrawer() fetchInfo() } const navigateToPage = (page) => { currentPage.value = page closeDrawer() } const toggleTheme = (event) => { if (event.target.checked) { document.body.classList.add('dark') document.body.classList.remove('light') } else { document.body.classList.add('light') document.body.classList.remove('dark') } } const pasteFromClipboard = async () => { try { const text = await navigator.clipboard.readText() url.value = text } catch (e) { error.value = 'クリップボードからの読み取りに失敗しました' } } const fetchInfo = async () => { if (!url.value) return loading.value = true error.value = null info.value = null try { const res = await fetch('/info', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ url: url.value }) }) if (!res.ok) { const errorData = await res.json() throw new Error(errorData.detail || '情報の取得に失敗しました') } info.value = await res.json() } catch (e) { error.value = e.message } finally { loading.value = false } } const formatDuration = (seconds) => { if (!seconds) return 'Live' const h = Math.floor(seconds / 3600) const m = Math.floor((seconds % 3600) / 60) const s = seconds % 60 return h > 0 ? ${h}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')} : ${m}:${s.toString().padStart(2, '0')} } const download = async () => { if (!info.value) return downloading.value = true error.value = null try { const payload = { url: url.value } if (selectedQuality.value === 'audio') { payload.audio_format = 'mp3' } else if (selectedQuality.value) { payload.quality = parseInt(selectedQuality.value) } const res = await fetch('/download', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) }) if (!res.ok) throw new Error('ダウンロードに失敗しました') const blob = await res.blob() const downloadUrl = window.URL.createObjectURL(blob) const a = document.createElement('a') a.href = downloadUrl a.download = ${info.value.title || 'video'}.${selectedQuality.value === 'audio' ? 'mp3' : 'mp4'} document.body.appendChild(a) a.click() window.URL.revokeObjectURL(downloadUrl) document.body.removeChild(a) saveToHistory(info.value) } catch (e) { error.value = e.message } finally { downloading.value = false } } onMounted(() => { loadHistory() }) return { url, info, loading, downloading, error, selectedQuality, currentPage, showDeleteModal, history, fetchInfo, formatDuration, download, navigateToPage, pasteFromClipboard, confirmClearHistory, clearHistory, loadFromHistory, toggleTheme } } }).mount('#app') </script> </body> </html>
