<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>yt-dlp Web Client</title>

<link href="https://cdn.jsdelivr.net/npm/beercss@3.13.1/dist/cdn/beer.min.css" rel="stylesheet">
<script type="module" src="https://cdn.jsdelivr.net/npm/beercss@3.13.1/dist/cdn/beer.min.js"></script>
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

<style>
/* ===== レイアウト ===== */
body {
  overflow-x: hidden;
}

#layout {
  display: flex;
}

/* ===== サイドバー ===== */
.sidebar {
  width: 240px;
  min-width: 240px;
  transition: width .2s ease;
  background: var(--surface);
}

.sidebar.mini {
  width: 72px;
  min-width: 72px;
}

.sidebar a {
  display: flex;
  align-items: center;
  gap: 16px;
}

.sidebar.mini span {
  display: none;
}

/* ===== メイン ===== */
main {
  flex: 1;
}

/* ===== 共通UI ===== */
.app-title {
  font-weight: 600;
}

.card {
  border-radius: 16px;
}

.thumbnail {
  aspect-ratio: 16 / 9;
  overflow: hidden;
  border-radius: 16px;
}

.thumbnail img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.duration {
  position: absolute;
  bottom: 6px;
  right: 6px;
  background: rgba(0,0,0,.7);
  padding: 4px 8px;
  border-radius: 6px;
  font-size: 12px;
}
</style>
</head>

<body class="dark">
<div id="app">
<div id="layout">

<!-- ===== サイドバー ===== -->
<nav class="sidebar" :class="{ mini: miniSidebar }">

  <!-- トグル -->
  <a @click="toggleMini">
    <i>{{ miniSidebar ? 'chevron_right' : 'chevron_left' }}</i>
    <span>折りたたむ</span>
  </a>

  <div class="divider"></div>

  <a @click="navigate('home')">
    <i>home</i>
    <span>ホーム</span>
  </a>

  <a @click="navigate('history')">
    <i>history</i>
    <span>履歴</span>
  </a>

</nav>

<!-- ===== メイン ===== -->
<main class="responsive">

<header>
  <nav>
    <h6 class="max app-title">yt-dlp Web Client</h6>
  </nav>
</header>

<!-- ===== HOME ===== -->
<section v-if="page === 'home'">

<article class="border card">
<div class="padding">
<h6>動画URL</h6>
<div class="field label border">
<input v-model="url" @keyup.enter="fetchInfo">
<label>YouTube / Twitter / ニコ動</label>
</div>

<nav class="right-align">
<button class="primary" @click="fetchInfo" :disabled="loading">
<i>search</i>
<span>{{ loading ? '解析中…' : '解析' }}</span>
</button>
</nav>
</div>
</article>

<article v-if="info" class="border card">
<div class="grid">

<div class="s12 m5">
<div class="thumbnail">
<img :src="info.thumbnail">
<div class="duration">{{ formatDuration(info.duration) }}</div>
</div>
</div>

<div class="s12 m7">
<div class="padding">
<h6>{{ info.title }}</h6>
<p class="small">{{ info.uploader }}</p>

<div class="field suffix border">
<select v-model="quality">
<option value="">最高画質</option>
<option value="1080">1080p</option>
<option value="720">720p</option>
<option value="audio">音声のみ</option>
</select>
<i>high_quality</i>
</div>

<button class="primary responsive" @click="download" :disabled="downloading">
<i>download</i>
<span>{{ downloading ? 'ダウンロード中…' : 'ダウンロード' }}</span>
</button>
</div>
</div>

</div>
</article>

</section>

<!-- ===== HISTORY ===== -->
<section v-if="page === 'history'">
<h5>ダウンロード履歴</h5>

<article v-for="item in history" class="border card">
<div class="row padding">
<img :src="item.thumbnail" style="width:120px;border-radius:12px">
<div class="max">
<p class="bold">{{ item.title }}</p>
<p class="small">{{ item.uploader }}</p>
</div>
</div>
</article>
</section>

</main>
</div>
</div>

<script>
const { createApp, ref } = Vue

createApp({
setup() {
  const url = ref('')
  const info = ref(null)
  const loading = ref(false)
  const downloading = ref(false)
  const quality = ref('')
  const page = ref('home')
  const history = ref([])
  const miniSidebar = ref(false)

  const toggleMini = () => {
    miniSidebar.value = !miniSidebar.value
  }

  const navigate = (p) => {
    page.value = p
  }

  const fetchInfo = async () => {
    loading.value = true
    const r = await fetch('/info', {
      method: 'POST',
      body: JSON.stringify({ url: url.value })
    })
    info.value = await r.json()
    loading.value = false
  }

  const download = async () => {
    downloading.value = true
    await fetch('/download', {
      method: 'POST',
      body: JSON.stringify({ url: url.value })
    })
    history.value.unshift(info.value)
    downloading.value = false
  }

  const formatDuration = (s) => {
    if (!s) return 'LIVE'
    const m = Math.floor(s / 60)
    const sec = s % 60
    return `${m}:${sec.toString().padStart(2, '0')}`
  }

  return {
    url, info, loading, downloading, quality,
    page, history,
    miniSidebar,
    toggleMini, navigate,
    fetchInfo, download, formatDuration
  }
}
}).mount('#app')
</script>

</body>
</html>
